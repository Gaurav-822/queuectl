Worker's Parallel Processing Testing

queuectl enqueue '{"id":"job1","command":"echo Quick success"}'
queuectl enqueue '{"id":"job2","command":"sleep 2 && echo Slept 2 seconds"}'
queuectl enqueue '{"id":"job3","command":"bash -c '\''exit 1'\''"}'
queuectl enqueue '{"id":"job4","command":"bash -c '\''sleep 1 && exit 1'\''"}'
queuectl enqueue '{"id":"job5","command":"echo DLQ test && false"}'
queuectl enqueue '{"id":"job6","command":"bash -c '\''sleep 3 && echo Done'\''"}'
queuectl enqueue '{"id":"job7","command":"bash -c '\''exit 42'\''"}'
queuectl enqueue '{"id":"job8","command":"bash -c '\''echo Job 8 running; sleep 1; exit 1'\''"}'
queuectl enqueue '{"id":"job9","command":"echo Parallel job test"}'
queuectl enqueue '{"id":"job10","command":"sleep 1 && echo Another quick one"}'
queuectl enqueue '{"id":"job11","command":"bash -c '\''ls /nonexistent'\''"}'
queuectl enqueue '{"id":"job12","command":"bash -c '\''for i in {1..3}; do echo Loop $i; sleep 1; done'\''"}'
queuectl enqueue '{"id":"job13","command":"echo Success message only"}'
queuectl enqueue '{"id":"job14","command":"bash -c '\''sleep 2 && false'\''"}'
queuectl enqueue '{"id":"job15","command":"bash -c '\''sleep 1 && echo Retrying...'\''"}'

# For Testing Edge Case where a Job passes on it's 3rd try
queuectl enqueue '{"id": "job_retry_test", "command": "bash -c '\''if [ ! -f /tmp/job_retry_marker ]; then echo first_fail >> /tmp/job_retry_marker && exit 1; elif [ $(grep -c first_fail /tmp/job_retry_marker) -lt 2 ]; then echo second_fail >> /tmp/job_retry_marker && exit 1; else echo SUCCESS && rm -f /tmp/job_retry_marker && exit 0; fi'\''"}'
rm -f /tmp/job_retry_marker


# Testing DLQ commands
queuectl config set max_retries 2
rm -f /tmp/job_retry_marker
queuectl enqueue '{"id": "job_retry_test_dead", "command": "bash -c '\''if [ ! -f /tmp/job_retry_marker ]; then echo first_fail >> /tmp/job_retry_marker && exit 1; elif [ $(grep -c first_fail /tmp/job_retry_marker) -lt 2 ]; then echo second_fail >> /tmp/job_retry_marker && exit 1; else echo SUCCESS && rm -f /tmp/job_retry_marker && exit 0; fi'\''"}'
queuectl dlq retry job_retry_test_dead